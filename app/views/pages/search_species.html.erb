<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
  var _calendar_asset_path = "<%= asset_path('calendar.png') %>";
</script>
<div class="row justify-content-center mt-2" id="search_species">
  <div class="col-10">
    <div class="row my-3">
      <div class="col">
      	<div class="row">
      	  <div class="col h4 text-center proxima section-header mb-3">Search Species</div>
      	</div>
        <% if params[:contest_id].present? %>
          <%= form_tag "/regions/search/species?contest_id=#{params[:contest_id]}", method: "POST", class: "input-group row justify-content-center" do %>
            <div class="col">
              <div class="row justify-content-center mt-3 search-species">
                <div class="col-2 justify-content-left px-1">
                  <%= text_field_tag 'start_dt', params[:start_dt], placeholder: "From Date" , readonly: true, class: 'text-center datepicker'%>

                </div>
                <div class="col-2 px-1">
                  <%= text_field_tag 'end_dt', params[:end_dt], placeholder: "To Date" , readonly: true, class: 'text-center datepicker'%>
                </div>
              </div>
              <div class="row justify-content-center mt-3 search-species">
                <div class="col-5 justify-content-left px-1">
    <%
=begin%>
  <%= text_field_tag 'search_by_species', params[:search_by_species], placeholder: "Search By scientific/common name" , class: 'form-control fw-bold', autocomplete: 'on', data: { autocomplete_source: Observation.all.distinct.pluck(:scientific_name).compact.to_json } %>
  <%
=end%>
                  <%= text_field_tag 'search_by_species', params[:search_by_species], placeholder: "Search by scientific or common name" , class: 'form-control fw-bold', autocomplete: 'on' %>
                </div>
                <div class="col-2 px-1">
                  <%= submit_tag "Search", class: 'btn btn-warning w-100 fw-bold no-overlap' %>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <%= form_tag "/regions/search/species", method: "POST", class: "input-group row justify-content-center" do %>
            <div class="col">
              <div class="row justify-content-center mt-2">
                <div class="col-3 justify-content-left px-1">
                  <%= select_tag(:contest_filter,
                              "<option value=''>All</option>".html_safe + options_for_select(Contest.in_progress.collect {|p| [ p['title'], p['id'] ] }, params[:contest_filter].to_i),
                              { :class => "form-select fw-bold", :selected => "All Contests"})
                  %>
                </div>
                <div class="col-2 justify-content-left px-1">
                  <%= text_field_tag 'start_dt', params[:start_dt], placeholder: "From Date", readonly: true, class: 'text-center datepicker'%>
                </div>
                <div class="col-2 justify-content-left px-1">
                  <%
=begin%>
 <div class="input-icons">
  <i class = "fa fa-calendar icon"></i>
<%
=end%>
                    <%= text_field_tag 'end_dt', params[:end_dt], placeholder: "To Date", readonly: true, class: 'text-center datepicker'%>
                  <%
=begin%>
 </div>
<%
=end%>
                </div>
              </div>
              <div class="row justify-content-center mt-3 search-species">
                <div class="col-5 justify-content-left px-1">
                  <%= text_field_tag 'search_by_species', params[:search_by_species], placeholder: "Search by scientific or common name" , class: 'form-control fw-bold', autocomplete: 'on' %>
                </div>
                <div class="col-2 px-1">
                  <%= submit_tag "Search", class: 'btn btn-warning w-100 fw-bold no-overlap' %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
<div class="row justify-content-center mt-2">
  <% if @searched_regions.present? %>
    <div class="col-12">
      <div class="row flex-nowrap flex-shrink-1 mb-3" id="searched_regions_block">
        <div class="header-col col-2 flex-nowrap flex-shrink-1 h6 " style="padding: 1 0 0 0;">
        </div>
        <div class="header-col col-3 fw-bold flex-nowrap flex-shrink-1 h6 yellow-font" style="padding: 1 0 0 0;">
        </div>
        <div class="header-col col-2 fw-bold flex-nowrap flex-shrink-1 h6 yellow-font align-self-center text-center" style="padding: 1 0 0 0;">
          Total Sightings
        </div>
        <div class="header-col col-1 fw-bold flex-nowrap flex-shrink-1 h6 yellow-font align-self-center text-center" style="padding: 1 0 0 0;">
          Property
        </div>
        <div class="header-col col-2 fw-bold flex-nowrap h6 yellow-font align-self-center text-center" style="padding: 1 0 0 0;">
          Neighborhood
        </div>
        <div class="header-col col-1 fw-bold flex-nowrap flex-shrink-1 h6 yellow-font align-self-center text-center" style="padding: 1 0 0 0;">
          Greater Region
        </div>
        <div class="header-col col-1 fw-bold flex-nowrap flex-shrink-1 h6 yellow-font align-self-center text-center" style="padding: 1 0 0 0;">
          BioScore
        </div>
      </div>
      <% @searched_regions.each do |r| %>
        <%= render partial: 'region_with_species_count', locals: { r: r , search_text: @search_by_species, taxonomy_ids: @taxonomy_ids, start_dt: @start_dt, end_dt: @end_dt} %>
      <% end %>
    </div>
  <% else %>
    <div class="row flex-nowrap flex-shrink-1 justify-content-center">
      <div class="col-10 align-self-center text-center h6 fw-bold">
        <% if params[:search_by_species] %>
          '<%= params[:search_by_species] %>' has not been found in any region
        <% end %>
      </div>
    </div>
  <% end %>
</div>
<% if @searched_regions.present? %>
  <%= paginate @searched_regions %>
<% end %>
