<!doctype html>
<html class="h-100">
  <head>
    <title>Biosmart</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!--meta property="og:url"           content="<%= @meta_url %>" />
    <meta property="og:type"          content="<%= @meta_type %>" />
    <meta property="og:title"         content="<%= @meta_title %>" />
    <meta property="og:description"   content="<%= @meta_description %>" />
    <meta property="og:image"         content="<%= @meta_image %>" />
    <meta property="og:image:width"   content="<%= @meta_image_width %>" />
    <meta property="og:image:height"  content="<%= @meta_image_height %>" />
    <meta property="fb:app_id"        content="<%= Rails.application.credentials.facebook_app_id %>" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@biosmart" />
    <meta name="twitter:creator" content="@biosmart" />

    <link rel="shortcut icon" href="<%= asset_path 'logo-512.png' %>">
    <link rel="apple-touch-icon" href="<%= asset_path 'apple-touch-icon-iphone-60x60.png' %>">
    <link rel="apple-touch-icon" sizes="60x60" href="<%= asset_path 'apple-touch-icon-ipad-76x76.png' %>">
    <link rel="apple-touch-icon" sizes="114x114" href="<%= asset_path 'apple-touch-icon-iphone-retina-120x120.png' %>">
    <link rel="apple-touch-icon" sizes="144x144" href="<%= asset_path 'apple-touch-icon-ipad-retina-152x152.png' %>"-->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyMJQSW8bBRxhAMYnQcJstMOlKXCnY0WM&libraries=drawing&libraries=drawing&v=weekly"></script>
    <%= stylesheet_link_tag "application", media: "all", "data-turbolinks-track" => "reload" %>
  </head>

  <body class="d-flex flex-column h-100">

    <header class="flex-shrink-0 m-0 p-0">
      <div class="container-fluid m-0 p-0">
        <div class="row justify-content-center p-0 pt-3 m-0">
          <div class="col-12 col-lg-10 p-0 m-0 logo-header position-relative">   
            <% if @user %>
              <a href="#" class="btn float-end py-0 px-3" data-bs-toggle="modal" data-bs-target="#profile" id="profile_button" role="button">Profile: <%= @user.organization_name %></a>
              <a href="/participants" class="btn float-end py-0 px-3 <%= @participations.nil? ? '' : 'text-decoration-underline' %>" role="button">Contest Participation</a>
              <a href="/regions" class="btn float-end py-0 px-3 <%= @regions.nil? ? '' : 'text-decoration-underline' %>" role="button">Regions</a>
        
              <% if @user.admin? %>
                <a href="/users" class="btn float-end py-0 px-3 <%= @users.nil? ? '' : 'text-decoration-underline' %>" role="button">Users</a>
                <a href="/contests" class="btn float-end py-0 px-3 <%= @contests.nil? ? '' : 'text-decoration-underline' %>" role="button">Contest Management</a>
              <% end %>
            <% else %>
              <a href="#" class="btn float-end py-0 px-3" data-bs-toggle="modal" data-bs-target="#login" id="login_button" role="button">Login</a>
              <a href="#" class="btn float-end py-0 px-3" data-bs-toggle="modal" data-bs-target="#signup" id="signup_button" role="button">Signup</a>
            <% end %>
            <a href="/" class="btn float-start py-0 px-3 fw-huge" role="button">Biosmart</a>
          </div>
        </div>
      </div>  
    </header>   

    <main class="flex-shrink-0 m-0 p-0 mb-5">
      <div class="container-fluid mt-3">
        <div class="row justify-content-center">
          <div class="col-12 col-md-8">
            <%= yield %>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer mt-auto border-top">
      <div class="container my-3">
        <div class="row text-center">
          <div class="col">&copy; Biosmart 2022</div>
        </div>
      </div>
    </footer>

    <div class="modal fade" tabindex="-1" id="login">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">        
            <h4 class="modal-title fw-heavy">Login</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row justify-content-center mt-5 mb-3">
              <div class="col-8">
                <div class="form-group">
                  <input type="text" class="form-control" placeholder="Email" required="required" id="email_login">
                </div>
              </div>
            </div>
            <div class="row justify-content-center mb-3">
              <div class="col-8">
                <div class="form-group">
                  <input type="password" class="form-control" placeholder="Password" required="required" id="password_login">
                </div>
              </div>    
            </div>
            <div class="row justify-content-center mb-3">
              <div class="col-8 justify-content-center">            
                <div class="form-group">
                  <button class="btn btn-outline-secondary w-100" id="login_action">Login</button>
                </div>
              </div>
            </div>    
            <div class="row justify-content-center mb-3">
              <div class="col-8 justify-content-center">            
                <span class="text-danger validation-ok">Couldn't log in.</span>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <a class="btn black text-decoration-underline" id="signup_from_login">Sign up</a>
          </div>
        </div>
      </div>
    </div> 

    <%= render partial: 'signup_modal', locals: { title: 'Signup', button_text: 'Sign up', id: 'signup', include_login_link: true } %>

    <div class="modal fade" tabindex="-1" id="signup_success">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">        
            <h4 class="modal-title fw-heavy">Signup successful</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row justify-content-center mt-5 mb-3">
              <div class="col-8 d-flex justify-content-center">You're good to go.</div>  
            </div> 
            <div class="row justify-content-center mt-5 mb-3">
              <div class="col-8 d-flex justify-content-center">Please log in to get started.</div>  
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <%= render partial: 'profile_modal', locals: { title: 'Profile', id: 'profile', include_logout_link: true, user: @user } %>

  </body>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js" integrity="sha256-0H3Nuz3aug3afVbUlsu12Puxva3CP4EhJtPExqs54Vg=" crossorigin="anonymous"></script>
  <% if @user %>
    <script>var _user_id = <%= @user.id %>;</script>
  <% end %>  
  <%= javascript_include_tag "application", "data-turbolinks-track" => "reload" %>
</html>
